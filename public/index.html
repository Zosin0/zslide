<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ZSlide</title>
        <style>
            body {
                font-family: Arial, sans-serif;
            }

            #render {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>

    <body>
        <div style="display: flex; width: 100vw; height: 100vh">
            <textarea id="md" style="flex: 1; resize: none; padding: 10px; box-sizing: border-box;"
                placeholder="Digite seu Markdown aqui..."></textarea>
            <div id="render" style="flex: 1; overflow-y: auto; padding: 10px; box-sizing: border-box;"></div>
        </div>

        <button id="exportPdf">Download PDF</button>
        <button id="exportPptx">Download PPTX</button>

        <script type="module">
            import { Marp } from 'https://esm.sh/@marp-team/marp-core?bundle'
            import browser from 'https://esm.sh/@marp-team/marp-core/browser'

            const marp = new Marp({ script: false, html: true, minifyCSS: true, html2canvas: { scale: 4, useCORS: true } })
            const md = document.getElementById('md')
            const render = document.getElementById('render')

            // Renderiza o Markdown em HTML conforme o usuário digita
            md.addEventListener('input', () => {
                const { html, css } = marp.render(md.value);
                render.innerHTML = `${html}<style>${css}</style>`;

                // Envia o conteúdo HTML para o servidor
                fetch('/save-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ html: render.innerHTML })
                }).then(response => response.text()).then(message => {
                    console.log(message);
                }).catch(error => {
                    console.error('Erro ao gerar PDF:', error);
                });
            });

            // Modificado para baixar diretamente do servidor
            document.getElementById('exportPdf').addEventListener('click', () => {
                window.location.href = '/download-pdf'; // URL atualizada para o endpoint de download
            });

            // Adicione um novo evento de clique para gerar o PPTX
            document.getElementById('exportPptx').addEventListener('click', () => {
                // Aqui você envia o conteúdo para o servidor para gerar o PPTX
                fetch('/generate-pptx', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ slidesContent: [/* conteúdo dos slides */] })
                }).then(response => {
                    if (response.ok) {
                        return response.blob();
                    }
                    throw new Error('Erro ao gerar PPTX');
                }).then(blob => {
                    const url = window.URL.createObjectURL(new Blob([blob]));
                    const link = document.createElement('a');
                    link.href = url;
                    link.setAttribute('download', 'presentation.pptx');
                    document.body.appendChild(link);
                    link.click();
                    link.parentNode.removeChild(link);
                }).catch(error => {
                    console.error('Erro ao baixar PPTX:', error);
                });
            });

        </script>
    </body>

</html>